<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>kg</title>
<script src="ext-all.js"></script>
<script src="packages/ext-locale/build/ext-locale-zh_CN.js"></script>
<link href="packages/ext-theme-crisp/build/resources/ext-theme-crisp-all.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="chooser.css" />
</head>
<body>
</body>
<script type="text/javascript">
	Ext.Loader.setConfig({enabled: true});
	Ext.Loader.setPath('Ext.chooser', '');
	Ext.require([
	    'Ext.chooser.IconBrowser'
	]);
/*	Ext.require([
    'Ext.tab.*',
    'Ext.window.*',
    'Ext.tip.*',
    'Ext.layout.container.Border'
]);
Ext.onReady(function(){
win = Ext.create('widget.window', {
                title: 'ext的网页排版',
                header: {
                    titlePosition: 2,
                    titleAlign: 'center'
                },
                closable: false,
                closeAction: 'hide',
                maximizable: false,
                animateTarget: button,
                width: "100%",
                minWidth: "100%",
                height: "100%",
                tools: [{type: 'pin'}],
                layout: {
                    type: 'border',
                    padding: 1
                },
                items: [{
                    region: 'west',
                    title: 'Navigation',
                    width: 200,
                    split: true,
                    collapsible: true,
                    floatable: false,
                    items:[{
                    	title:'tianjingle'
                    }]
                }, {
                    region: 'center',
                    xtype: 'tabpanel',
                    items: [{
                        // LTR even when example is RTL so that the code can be read
                        rtl: false,
                        title: 'Bogus Tab',
                        html: '<p>Window configured with:</p><pre style="margin-left:20px"><code>header: {\n    titlePosition: 2,\n    titleAlign: "center"\n},\nmaximizable: true,\ntools: [{type: "pin"}],\nclosable: true</code></pre>',
                        closable:true
                    }, {
                        title: 'Another Tab',
                        html: 'Hello world 2',
                        closable:true
                    }, {
                        title: 'Closable Tab',
                        html: 'Hello world 3',
                        closable: true
                    }]
                },{
                	region:'east',
                	   rtl: true,
                	width:100,
                	split:false,
                	collapsible: true,
                    floatable: false,
                },{
                	region:'south',
                	height:100,
                	split:false,
                	collapsible: true,
                    floatable: false,
                    items:[{
                    	region:'east',
                    	xtype:'button',
                    	items:[{
                    		title:'button1'
                    	}]
                    }]
                }]
            });
		win.show();
        })*/
        	function initMenu() {
        		Ext.Ajax.request({
        					url : '/local/initmenu.do',
        					success : function(response) { 
           					var text = eval('('+response.responseText+')');

        						if (text.success) {
        							var menulist = text.data;
        							var sysPanel = null;
        							for ( var i = 0; i < menulist.length; i++) {
        								var menu = menulist[i];
        								sysPanel = Ext.create('Ext.panel.Panel', {
        									title : menu['name'],
        									autoScroll : true
        								});
        								 var IconBrowser = Ext.create('Ext.chooser.IconBrowser',{
											cls : 'img-chooser-view',
											baseCls : 'img-chooser-view',
											selectedItemCls : 'img-chooser-view',
											listeners : {
												itemclick : function(view, record,item, index) {
													Ext.Ajax.request({
																type : "POST",
																url : '/local/timeout.do',
																headers : {
																	'Content-Type' : 'application/json; charset=utf-8'
																},
																async : false,
																callback : function(options,success,response) {
																	var text = JSON.parse(response.responseText);
																	if (!text.success) {
																		Ext.Msg.alert('alert', 'timeout ?',function(btn){
																				if(btn=='yes'){
																					top.location.href = '${ctx}/ES/zyj/loginout.action';
																				}
																			})
																	} else {
																		var url=record.data.resourceurl
																		openTab(record.data.resourcename,url,record.data.content);
																	}
																}
															});
												}
											}
										}); 
        								IconBrowser.getStore().loadData(menu['child']);
        								sysPanel.add(IconBrowser); 
        								menuPanel.add(sysPanel);
        							}
        						}
        					}
        				});
        	}
       var openTab = function(mname, murl, content) {
        		var tab = centerPanel.getComponent(mname);
        		if (!tab) {
			var tabPanel = Ext.create('Ext.panel.Panel',{
					id : mname,
					title : mname,
					layout : 'fit',
					border : false,
					closable : true,
					html : '<iframe scrolling="no" width="100%" height="100%" frameborder="0" src="'
							+ murl + '"></iframe>'
				});
        			tab = centerPanel.add(tabPanel);
        			centerPanel.setActiveTab(tab);
        		} else {
        			centerPanel.setActiveTab(tab);
        		}
        	}
        var east=Ext.create('Ext.Panel',{
        	region:'east',
        	collapsible:true,
        	split:true,
        	width:100
        })
       	var north = Ext.create('Ext.Panel',{
        		//width:600,
        		height:40,
				region : 'north',
			    }
			 )

          var menuPanel=Ext.create('Ext.Panel', {
        		title : '测试',
        		region : 'west',
        		collapsible : true,
        		split : true,
        		width : 200,
        		//height:400,
        		layout : {
        			type : 'accordion',
        			hideCollapseTool : false,
        			autoScroll : true
        		},
        		hideCollapseTool : true
        	});

	      var centerPanel = Ext.create('Ext.tab.Panel', {
			region : 'center',
			xtype : 'tabpanel',
			activeTab : 0,
			border : true,
			width:600,
			height:600,
			maxTabWidth : 200,
			minTabWidth : 100,
			items : {
				title : 'desk',
				html : ''
			}
		});

            //编写south panel  
            var south = new Ext.panel.Panel({
        		height:30,
            	title : '2019 happy new year!',
                region:'south',
            });

            function appInit(){
     /*       	initSize(centerPanel);
            	initSize(north);
            	initSize(menuPanel);
            	initSize(south);*/
            	initMenu();
        		Ext.create('Ext.Viewport', {
        			layout : 'border',
        			items : [ north, menuPanel, centerPanel,south ]
        		});
            }
             Ext.onReady(appInit);

</script>
</html>